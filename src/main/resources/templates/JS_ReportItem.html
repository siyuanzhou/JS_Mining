<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Creative - Bootstrap 3 Responsive Admin Template">
    <meta name="author" content="GeeksLabs">
    <meta name="keyword" content="Creative, Dashboard, Admin, Template, Theme, Bootstrap, Responsive, Retina, Minimal">

    <title>实力对比</title>

    <!-- Bootstrap CSS&js -->
    <link href="../contrast/css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/bootstrap/bootstrap.min.css" rel="stylesheet">
    <script src="../js/bootstrap/bootstrap.min.js"></script>
    <!-- bootstrap theme -->
    <!--    <link href="../contrast/css/bootstrap-theme.css" rel="stylesheet">-->

    <!--external css-->
    <!-- font icon -->
    <link href="../contrast/css/elegant-icons-style.css" rel="stylesheet"/>
    <link href="../contrast/css/font-awesome.min.css" rel="stylesheet"/>

    <link rel="stylesheet" href="../contrast/css/fullcalendar.css">
    <link href="../contrast/css/widgets.css" rel="stylesheet">
<!--    <link href="../contrast/css/style.css" rel="stylesheet">-->
    <link href="../contrast/css/style-responsive.css" rel="stylesheet"/>
    <link href="../contrast/css/xcharts.min.css" rel=" stylesheet">
    <link href="../contrast/css/jquery-ui-1.10.4.min.css" rel="stylesheet">

    <!--旭日图所需script文件-->
    <script src="https://code.highcharts.com.cn/highcharts/highcharts.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/exporting.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/sunburst.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/series-label.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/oldie.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/annotations.js"></script>
    <script src="https://code.highcharts.com.cn/highcharts/modules/wordcloud.js"></script>


    <script src="https://cdn.bootcss.com/popper.js/1.14.7/umd/popper.min.js"></script>
    <script type="text/javascript" src="./js/report_upload/jquery.min.js"></script>
    <script type="text/javascript" src="./js/report_upload/bootstrap.min.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/report_upload/bootbox.min.js"></script>
    <script type="text/javascript" src="./js/report_upload/bootstrap-select.min.js"></script>
    <script type="text/javascript" src="./js/report_upload/defaults-zh_CN.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/report_upload/style.css">
    <link rel="stylesheet" href="./css/report_upload/bootstrap-select.min.css">
    <!--字体样式-->
    <link rel="stylesheet" type="text/css" href="./css/common_css/zzsc-demo.css">
    <link rel='stylesheet prefetch' href='./css/common_css/normalize.css'>
    <link rel="stylesheet" href="./css/common_css/style.css" media="screen" type="text/css"/>
    <link rel="stylesheet" type="text/css" href="http://cdn.bootcss.com/font-awesome/4.6.0/css/font-awesome.min.css">
    <style>
        * {
            touch-action: pan-y;
        }

        .newli {
            text-decoration: none;
            list-style: none;
        / / 去掉li前面的圆点 display: inline;
        / / 让li横向排列 border: 1 px solid #FFFFFF;
            background-color: #30DDEB;
            width: 300px;
        }

        span.second-block {
            margin-left: 0.5em;
        }
        .first-block{
            font-family: "微软雅黑 Light";
            font-size: 18px;
            font-weight: 600;
        }
    </style>
    <!--echarts插件-->
    <script src="https://cdn.bootcss.com/echarts/4.2.1-rc1/echarts.min.js"></script>

</head>
<body style="background-color: inherit;color: #0f0f0f">

<div th:insert="~{/JS_Common::topbar}"></div>
<div style="display: flex;">
    <div th:insert="~{/JS_Common::leftbar}"></div>
    <div style="display: block;width:100%">
        <!-- container section start -->
        <section id="container" class="">

            <!--<h1 style="text-align: center">文本分类</h1>-->
            <div class="container">
                <!--style="padding-left: 50px;height:1000px;display: flex;flex-direction: column;width:100%;overflow-y: auto"-->
                <div class="panel panel-primary">
                    <div id="head" class="panel-heading" style="text-align: center;font-family: 华光准圆_CNKI;font-weight: 500;font-size: 38px">
<!--                        <h1 id="head" style="text-align: center;width: 1000px;color: #0f0f0f;font-family: 华光准圆_CNKI;font-weight: 800"></h1>-->
                    </div>
                    <div class="panel-body" >
                        <div style="margin-left: 700px">
                            <ul class="info" style="width: 600px;display: flex">
                                <div style="width: 200px;text-align: left"><span class="first-block">范围:</span><span
                                        class="second-block"><a id="fscope"></a></span>
                                </div>
                                <div style="width: 300px;text-align: left"><span class="first-block">领域:</span><span
                                        class="second-block"><a id="sscope"></a></span>
                                </div>
                            </ul>
                            <ul class="info" style="width: 600px;display: flex">
                                <div style="width: 200px;text-align: left"><span class="first-block"
                                                                                 style="width: 300px;text-align: left">来源:</span><span
                                        class="second-block"><a id="source"></a></span>
                                </div>
                                <div style="width: 200px;text-align: left"><span class="first-block"
                                                                                 style="width: 300px;text-align: left">国家:</span><span
                                        class="second-block"><a
                                        id="country"></a></span></div>
                            </ul>
                            <ul class="info" style="width: 600px;display: flex">
                                <div style="width: 200px;text-align: left"><span class="first-block"
                                                                                 style="width: 300px;text-align: left">开始日期:</span><span
                                        class="second-block"><a
                                        id="start"></a></span></div>
                                <div style="width: 200px;text-align: left"><span class="first-block"
                                                                                 style="width: 300px;text-align: left">结束日期:</span><span
                                        class="second-block"><a id="end"> </a></span>
                                </div>
                            </ul>
                        </div>
                        <p style="color: black;margin: 30px"><span style="color: #2759c2;font-weight:bold">摘要：</span>
                            <a id="summary" style="line-height:1.8em;color: #0f0f0f"></a>
                        </p>
                        <p style="color: black;margin: 30px"><span style="color: #2759c2;font-weight:bold">关键词：</span>
                            <a id="keywords" style="color: #0f0f0f;font-weight: 700;"></a>
                        </p>
                        <span style="color: #2759c2">  </span>
                        <div class="row" style="margin: 30px;">
                            <div id="img1"></div>
                        </div>

                        <!--实体、关系展示-->
                        <div class="row" style="margin: 30px;">
                            <div class="panel panel-default" >
                                <p id="introduce" style="text-indent: 2em;line-height:2em;font-family: 华光准圆_CNKI;"></p>
                                <!--<div class="panel-heading" style="text-align: center">关键实体</div>-->
                                <div id="entity" class="panel-body" style="height: 420px;border: 0px">
                                </div>
                            </div>
                        </div>

                        <!--文本分类-->
                        <div class="row" style="margin: 30px;">
                            <div id="detail4" style="text-indent: 2em;line-height:2em;margin-top:1px;margin-left:1px;font-family: 华光准圆_CNKI">
                            </div>
                            <div class="panel-body" id="classify_div"
                                 style="width: 1000px;height: 400px;margin-left: 20px;">
                            </div>
                        </div>

                        <!--科技实力折线图对比-->
                        <div class="row" style="margin: 30px;">
                            <div class='col-sm-3'>
                                <div class="form-group">
                                    <label>国家:</label>
                                    <select id="dcountry" class="form-control select_down selectpicker" multiple
                                            data-live-search="true" title="请选择国家">
                                        <option>中国</option>
                                        <option>美国</option>
                                        <option>德国</option>
                                        <option>意大利</option>
                                        <option>法国</option>
                                        <option>中东</option>
                                    </select>
                                </div>
                            </div>
                            <div class='col-sm-3'>
                                <div class="form-group">
                                    <label>领域</label>
                                    <select id = "lingyu" class="form-control select_down" style="font-size: 13px; color: #666;">
                                        <option>自然语言处理</option>
                                        <option>计算机视觉</option>
                                        <option>AI计划与应用</option>
                                        <option>机器人技术</option>
                                        <option>优化算法与理论</option>
                                        <option>语音识别</option>
                                        <option>个性化推荐</option>
                                    </select>
                                </div>
                            </div>
                            <div class='col-sm-3'>
                                <div class="search_input" style="margin-top: 30px">
                                    <button class="btn btn-primary search_btn" type="button" id="duibi">实力对比</button>
                                </div>
                            </div>
                        </div>

                        <!--旭日图实力对比-->
                        <div class="row" style="margin: 30px;">
                            <div id="detail1" style="display:inline-block;text-indent:2em;line-height:2em;font-family: 华光准圆_CNKI">
                            </div>
<!--                            <div class="col-lg-6 col-md-6" style="margin-top:10px;margin-left:50px;display:inline-block;">-->
                                <div class="panel panel-default" >
                                    <div class="panel-body" id="sunshine" style="margin: auto;width: 600px;height: 600px;">
                                    </div>
                                </div>
<!--                            </div>-->
                            <div id="detail2" style="display:inline-block;text-indent:2em;line-height:2em;font-family: 华光准圆_CNKI">
                            </div>
                        </div>

                        <!--科技实力折线图对比-->
                        <div class="row" style="margin: 30px;">
                            <div class="panel-body" id="serialsLabel" style="width: 800px;height: 400px;margin-left: 150px">
                            </div>
                        </div>

                        <div class="row" style="margin: 30px;">
                            <div class='col-sm-3'>
                                <div class="form-group">
                                    <label>国家:</label>
                                    <select id="pcountry" class="form-control select_down" title="请选择国家">
                                        <option>中国</option>
                                        <option>美国</option>
                                        <option>德国</option>
                                        <option>意大利</option>
                                        <option>法国</option>
                                        <option>中东</option>
                                    </select>
                                </div>
                            </div>

                            <div class='col-sm-3'>
                                <div class="form-group">
                                    <label>范围</label>
                                    <select id="psecondScope" class="form-control select_down"
                                            style="font-size: 13px; color: #666;">
                                        <option name="NLP">自然语言处理</option>
                                        <option name="CV" >计算机视觉</option>
                                        <option name="AI projects and applications">AI计划与应用</option>
                                        <option name="robot technology">机器人技术</option>
                                        <option name="Optimization algorithm theory">优化算法与理论</option>
                                        <option>语音识别</option>
                                        <option name="Recommended system">个性化推荐</option>
                                    </select>
                                </div>
                            </div>

                            <div class='col-sm-3'>
                                <div class="search_input" style="margin-top: 30px">
                                    <button class="btn btn-primary search_btn" type="button" id="yuce">趋势预测</button>
                                </div>
                            </div>
                        </div>
                            <!--趋势预测-->
                        <div class="row" style="margin: 30px;">
                            <div id="detail5" style="text-indent: 2em;line-height:2em;margin-top:1px;margin-left:1px;font-family: 华光准圆_CNKI">
                            </div>
                            <div class="panel-body" id="predict_div2"
                                 style="width: 800px;height: 400px;margin-left: 150px;">
                            </div>
                        </div>

                        <!--趋势预测-技术突袭-->
                        <div class="row" style="margin: 30px;">
                            <div id="detail3" style="text-indent: 2em;line-height:2em;margin-top:1px;margin-left:1px;font-family: 华光准圆_CNKI">
                            </div>
                            <div class="panel-body" id="predict_div"
                                 style="width: 800px;height: 400px;margin-left: 150px;">
                            </div>
                        </div>
                    </div>

                    <!-- Table -->
                    <table class="table">
                        ...
                    </table>
                </div>

            </div>
            <!--main content end-->
        </section>
        <!-- container section start -->
    </div>

    <!--右键菜单定义-->
    <div id="popupRC" style="display:none;" class="panel panel-primary  ">
        <div class="panel-heading" style="background-color: #F1F1F1;">
            <a href="javascript:txt2img(getSelectionText())">多模态检索图片</a>
        </div>
        <div class="panel-body" id="showImg">
            <!-- <div class="form-group">
                <label class="control-label col-md-2">Color</label>

                <input type="color" class="form-control" id="idcolorr" />
            </div> -->
            <div style="display: flex;flex-direction: row">

            </div>
        </div>
        <div class="panel-footer"><input type="button"  class="btn btn-danger" value="关闭" onClick="closeMenu()" /></div>
    </div>
</div>
<!-- javascripts -->
<script src="../contrast/js/jquery.js"></script>

<script>
    var start = localStorage.getItem("start");
    var end = localStorage.getItem("end");
    var firstScope = localStorage.getItem("firstScope");
    var country = localStorage.getItem("country");
    var secondScope = localStorage.getItem("secondScope");
    var source = localStorage.getItem("source");
    var text_data = localStorage.getItem("text_data");
    var countrys = country.split(",");
    var random = localStorage.getItem("random");
    var select_area = "";
    <!--右键菜单多模态检索图片相关-->
    function getSelectionText() {
        if(window.getSelection) {
            return  window.getSelection().toString();
        } else if(document.selection && document.selection.createRange) {
            return document.selection.createRange().text;
        }
        return '';
    }

    function txt2img(input) {
        $.ajax({
            url: "http://127.0.0.1:2346/txt2img",
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(input),
            success: function( data ){
                // fill the html for answer
                var array=data['output'];
                // alert(array[0][0]);
                if (array.length === 0){
                    $("#showImg").append("目前未检索到相似结果");
                }
                for(var i=0;i<array.length/2;i++){
                    // $('#menu').append('          <div class="col-sm-6 col-md-3">\n' +
                    //     '                <div class="thumbnail">\n' +
                    //     '                  <img src='+array[i][0]+' alt="...">\n' +
                    //     '                  <div class="caption">\n' +
                    //     '                    <p><b>武器介绍</b></p>\n' +
                    //     '                    <p>'+array[i][1]+'</p>\n' +
                    //     '                  </div>\n' +
                    //     '                </div>\n' +
                    //     '          </div>');
                    $('#showImg').append("<div style=\"display: flex;flex-direction: row\">\n" +
                        "                <img style='width: 180px;height: 120px' src=\"" + array[i * 2][0]+  "\">\n" +
                        "                <img style='width: 180px;height: 120px' src=\"" + array[i * 2 + 1][0]+  "\">\n" +
                        "            </div>");
                }
            },
            error: function( jqXhr, textStatus, errorThrown ){
                console.log( errorThrown );
            },
            timeout: 200000 // sets timeout to 10 seconds
        });
    }

    function closeMenu(){
        $('#popupRC').css({ display: 'none' });
        $('#showImg').html("");
    }

    $(function () {
        $("#container").bind('contextmenu', function (e) {
            e.preventDefault(); // prevents default menu
            $("#popupRC").css({ position: "fixed", top: e.screenY - 50, left: e.screenX, display: "block" });
        });
    });

    $(function () {

        $("#introduce").html("抽取" + firstScope + "领域相关实体如下：");
        $("#head").html(start.substring(0, 4) + "-" + end.substring(0, 4) + country + firstScope + "领域科技简报");
        $("#fscope").html(firstScope);
        $("#sscope").html(secondScope);
        $("#country").html(country);
        $("#source").html(source);
        $("#start").html(start);
        $("#end").html(end);

        $.ajax({
            url: "http://127.0.0.1:8000/multiReport",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_multireport",//回调方法
            contentType: 'application/json',
            data: {
                'texts': text_data.toString(),
            },
            success: function (data) {
                console.log(data);
                //alert(JSON.stringify(data));
                $("#summary").html(JSON.stringify(data));
            }
        });

        $.ajax({
            url: "http://127.0.0.1:8888/keywords",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_keywords",//回调方法
            contentType: 'application/json',
            data: {
                'text': text_data.toString(),
            },
            success: function (data) {
                console.log(data);
                //alert(JSON.stringify(data));
                alert(data.keywords);
                var str = "";
                for (var i = 0; i < data.keywords.length; i++) {
                    str += data.keywords[i] + ";"
                }
                $("#keywords").html(str);
                printWordsLabel(data.cloud);
            }
        });


        $.ajax({
            url: "http://127.0.0.1:8888/api",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_api",//回调方法
            contentType: 'application/json',
            data: {input: JSON.stringify(text_data)},

            success: function (data) {
                var str1 = data.input;
                var entityMap = data.listDemo;
                var raw_relations = data.raw_relations;
                var datas = raw_relations[0];
                var links = raw_relations[1];
                showRela(datas, links);
                console.log(str1);
            },
            error: function (jqXhr, textStatus, errorThrown) {
                console.log(errorThrown);
            }
        });

        $.ajax({
            url: "http://127.0.0.1:7000/classify",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_classify",//回调方法
            contentType: 'application/json',
            data: {input: JSON.stringify(text_data)},
            success: function (data) {
                showType(data);
                console.log(data);
            },
            error: function () {
                console.log("error");
            },
        });

    });

    $("#duibi").click(function () {

        var select_area = $('#lingyu option:selected').text();//文本
        countrys = $('#dcountry').val();//文本
        $.ajax({
            url: "http://127.0.0.1:7450/detail",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_detail",//回调方法
            contentType: 'application/json',
            data: {
                'field_name':  select_area,
                'country_list': JSON.stringify(countrys),
                'start_year': start.substring(0, 4),
                'end_year': end.substring(0, 4),
            },
            success: function (data) {
                console.log(data);
                var info = JSON.parse(data);
                $("#detail1").html(info.before_pic);
                $("#detail2").html(info.after_pic);
                $.ajax({
                    url: "http://127.0.0.1:7450/sunburst",
                    method: 'POST',
                    dataType: 'jsonp',
                    jsonp: "callback",
                    jsonpCallback: "successCallback_sunburst",//回调方法
                    contentType: 'application/json',
                    data: {
                        'field_name':  select_area,
                        'country_list': JSON.stringify(countrys),
                        'start_year': start.substring(0, 4),
                        'end_year': end.substring(0, 4),
                        'random': random,
                    },
                    success: function (data) {
                        var datas = JSON.parse(data);
                        var arr = [];
                        for (var i = 0; i < datas.length; i++) {
                            var jsonStr = JSON.stringify(datas[i]);       //转为JSON字符串
                            var jsObject = JSON.parse(jsonStr);    //转换为json对象
                            arr.push(jsObject);
                        }
                        printSunShine(arr);
                    }
                });
            }
        });

        $.ajax({
            url: "http://127.0.0.1:7450/linechart",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_LineChart",//回调方法
            contentType: 'application/json',
            data: {
                'field_name':  select_area,
                'country_list': JSON.stringify(countrys),
                'start_year': start.substring(0, 4),
                'end_year': end.substring(0, 4),
                'indicator_name': "科技产出",
                'random': random,
            },
            success: function (data) {
                console.log("data=" + data);
                $("#serialsLabel").empty();
                printSerialsLabel(JSON.parse(data));
            }
        });

    });

    $("#yuce").click(function () {

        var country = $('#pcountry').val().toString();//文本
        var obj = document.getElementById("psecondScope");
        var index=obj.selectedIndex;
        var select_area = obj.options[index].getAttribute("name");
        $.ajax({
            url: "http://127.0.0.1:7650/predict",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_predict",//回调方法
            contentType: 'application/json',
            data: {
                "field": select_area
            },
            success: function (data) {
                console.log("data=" + data);
                data = JSON.stringify(data);
                var predict_data = JSON.parse(data);
                $("#detail3").html(predict_data.text);
                alert(predict_data.text)
                printPredictLabel(predict_data);
            },
        });

        $.ajax({
            url: "http://127.0.0.1:7005/predict2",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback_predict2",//回调方法
            contentType: 'application/json',
            data: {
                "field": select_area,
                "country":country,
            },
            success: function (data) {
                console.log("data=" + data);
                data = JSON.stringify(data);
                var predict_data = JSON.parse(data);
                $("#detail5").html(predict_data.text);
                printPredictLabel2(predict_data);
            },
        });
    });

    // 数组去重
    function UniqObj(array) {     // 对象去重方法
        var allArr = [];    //建立新的临时数组
        for (var i = 0; i < array.length; i++) {
            var flag = true;
            for (var j = 0; j < allArr.length; j++) {
                if (array[i].name == allArr[j].name) {
                    flag = false;
                }
            }
            if (flag) {
                allArr.push(array[i]);
            }
        }
        return allArr;
    }

    function printWordsLabel(data) {

        var wordChart = Highcharts.chart('img1', {
            series: [{
                type: 'wordcloud',
                data: data,
            }],
            title: {
                text: ''
            }
        });

    }

    // 显示关系图
    function showRela(data, links) {
        var myChart = echarts.init(document.getElementById('entity'));
        var categories = [];
        for (var i = 0; i < 2; i++) {
            categories[i] = {
                name: '类目' + i
            };
        }
        option = {
            series: [{
                type: 'graph', // 类型:关系图
                layout: 'force', //图的布局，类型为力导图
                symbolSize: 50, // 调整节点的大小
                roam: true, // 是否开启鼠标缩放和平移漫游。默认不开启。如果只想要开启缩放或者平移,可以设置成 'scale' 或者 'move'。设置成 true 为都开启
                edgeSymbol: ['circle', 'arrow'],
                edgeSymbolSize: [2, 10],
                edgeLabel: {
                    normal: {
                        textStyle: {
                            fontSize: 20
                        }
                    }
                },
                force: {
                    repulsion: 250,
                    edgeLength: [100, 150]
                },
                draggable: true,
                lineStyle: {
                    normal: {
                        width: 2,
                        color: '#4b565b'
                    }
                },
                edgeLabel: {
                    normal: {
                        show: true,
                        formatter: function (x) {
                            return x.data.name;
                        }
                    }
                },
                label: {
                    normal: {
                        show: true,
                        textStyle: {}
                    }
                },
                categories: categories
            }]
        };
        var tmp = option.series;
        tmp[0]['data'] = UniqObj(data);
        tmp[0]['links'] = links;
        // console.log(tmp[0]['data'],tmp[0]['links']);
        myChart.setOption(option);
    }

    // 文本分类图
    var myTypeChart = echarts.init(document.getElementById('classify_div'));
    function showType(data) {
        //echarts表格
        myTypeChart.setOption({
            title: {
                text: '文本分类结果',
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'shadow'
                }
            },
            legend: {
                /*  data: [ '2012年']*/
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '3%',
                containLabel: true
            },
            xAxis: {
                type: 'value',
                boundaryGap: [0, 0.01],
                max: 1.0
            },
            yAxis: {
                type: 'category',
                data: data.classify,
            },
            series: [{
                name: '数量',
                type: 'column',
                itemStyle: {
                    normal: {
                        color: '#0b96e5'
                    }
                },
                data: data.probability,
            }]
        });
        setTimeout(function (){
            window.onresize = function () {
                myTypeChart.resize();
            }
        },400)
    }


    // 实力对比折线图
    function printSerialsLabel(data) {

        console.log("lineData=" + data);
        var countries =  countrys
        var c = countries.toString().replaceAll(",", "、")
        var serialChart = Highcharts.chart('serialsLabel', {
            title: {
                text: c + select_area + '领域科技实力对比折线图'
            },
            colors: [ '#c70831', 'rgba(0,201,66,0.97)','rgba(0,171,201,0.97)',
                'rgba(214,229,6,0.97)','rgba(118,57,220,0.97)','rgba(198,105,35,0.97)'],
            subtitle: {
                text: ''
            },
            yAxis: {
                title: {
                    text: '实力指数'
                }
            },
            legend: {
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle'
            },
            plotOptions: {
                series: {
                    label: {
                        connectorAllowed: false
                    },
                    pointStart: parseInt(start.substring(0, 4))
                }
            },

            series: data,
            // responsive: {
            //     rules: [{
            //         condition: {
            //             maxWidth: 500
            //         },
            //         chartOptions: {
            //             legend: {
            //                 layout: 'horizontal',
            //                 align: 'center',
            //                 verticalAlign: 'bottom'
            //             }
            //         }
            //     }]
            // }
        });

    }

    //旭日图
    function printSunShine(data) {
        var countries =  countrys
        var c = countries.toString().replaceAll(",", "、")
        Highcharts.setOptions({
            lang: {
                thousandsSep: ',',
                turboThreshold: 2000
            }
        });
        Highcharts.getOptions().colors.splice(0, 0, 'transparent');
        Highcharts.chart('sunshine', {
                chart: {
                    height: '100%'
                },
                colors: [ '#c70831', 'rgba(0,201,66,0.97)','rgba(0,171,201,0.97)',
                    'rgba(214,229,6,0.97)','rgba(118,57,220,0.97)','rgba(198,105,35,0.97)'],
                title: {
                    text: c + select_area + '领域实力对比体系'
                },
                series: [{
                    type: "sunburst",
                    data: data,
                    allowDrillToNode: true,
                    cursor: 'pointer',
                    dataLabels: {
                        /**
                         * A custom formatter that returns the name only if the inner arc
                         * is longer than a certain pixel size, so the shape has place for
                         * the label.
                         */
                        formatter: function () {
                            var shape = this.point.node.shapeArgs;

                            var innerArcFraction = (shape.end - shape.start) / (2 * Math.PI);
                            var perimeter = 2 * Math.PI * shape.innerR;

                            var innerArcPixels = innerArcFraction * perimeter;

                            if (innerArcPixels > 16) {
                                return this.point.name;
                            }
                        }
                    },
                    levels: [{
                        level: 2,
                        colorByPoint: true,
                        dataLabels: {
                            rotationMode: 'parallel'
                        }
                    },
                        {
                            level: 3,
                            colorVariation: {
                                key: 'brightness',
                                to: -0.5
                            }
                        }, {
                            level: 4,
                            colorVariation: {
                                key: 'brightness',
                                to: 0.5
                            }
                        }]

                }],
                tooltip: {
                    headerFormat: "",
                    pointFormat: '<b>{point.name}</b>的得分为：<b>{point.value}</b>'
                }
            }
        )
    }

    //预测-技术成熟度
    function printPredictLabel(data) {

        console.log(typeof data);
        var result= [];
        var push1 = {};
        push1["name"] = "历史数据";
        var data_history = Array.prototype.slice.call(data.history);
        var warn_point = data_history.pop();
        data_history.push({y: warn_point, id: 'warn'});
        push1["data"] = data_history;
        var push2 = {};
        push2["name"] = "预测数据";
        push2["data"] = data.predict;
        var push3 = {};
        push3["name"] = "diff";
        push3["data"] = data.diff;
        result.push(push2);
        result.push(push1);
        result.push(push3);
        console.log("resultData=" + result);
        console.log("技术成果=" + data.技术成果);

        var serialChart = Highcharts.chart('predict_div', {
            title: {
                text: select_area + '技术成熟度分析图'
            },
            subtitle: {
                text: ''
            },
            colors: ['rgba(1,45,101,0.74)', '#c70831', 'rgba(0,201,66,0.97)','rgba(0,171,201,0.97)'],
            yAxis: [{
                title: {
                    // text: '技术成熟度',
                    enabled: false
                },
                labels:{
                    enabled: false
                },
            },{
                title: {
                    text: '论文增长量',
                    style:{
                    },
                },
                labels:{
                    style:{
                    },
                },
            },{
                title: {
                    text: '技术成果',
                    style:{
                    },

                },
                labels:{
                    style:{
                    },
                },
                opposite:true
            },],
            //x轴分四个阶段用不同背景颜色表示
            xAxis: {
                plotBands: [
                    { //彩色带横跨绘图区，标志着轴间隔。
                        color: 'rgba(201,236,206,0.88)',
                        from: 1958,
                        to: 1958 + data.萌芽期,
                        label:{
                            text: '萌芽期'
                        }
                    },
                    { //彩色带横跨绘图区，标志着轴间隔。
                        color: 'rgb(238,245,197)',
                        from: 1958 + data.萌芽期,
                        to: 1958 + data.发展期,
                        label:{
                            text: '发展期'
                        }
                    },
                    { //彩色带横跨绘图区，标志着轴间隔。
                        color: 'rgba(232,199,199,0.83)',
                        from: 1958 + data.发展期,
                        to: 1958 + data.成熟期,
                        label:{
                            text: '成熟期'
                        }
                    },
                    { //彩色带横跨绘图区，标志着轴间隔。
                        color: 'rgba(219,198,236,0.82)',
                        from: 1958 + data.成熟期,
                        to: 3000,
                        label:{
                            text: '衰退期'
                        }
                    },
                ],
            },
            plotOptions: {
                series: {
                    label: false,
                    pointStart: 1958
                }
            },
            series:[{
                type:'scatter',
                name: '技术发展',
                data: data_history,
                zIndex: 6,
                marker:{
                    enable: true,
                    radius: 2,
                }
            },{
                name: '技术生命周期',
                data: data.predict,
                zIndex: 6,

            },{
                name: '论文增长量',
                data: data.diff,
                zIndex: 5,
                yAxis: 1
            },{
                name: '技术成果',
                data: data.技术成果,
                type: 'column',
                yAxis: 2,
                zIndex: 0,
                marker:{
                    enabled: true,
                    symbol: 'square'
                }
            },
            //     {
            //     name: '预警点',
            //     data: [{x: 1958 + data_history.length - 1, y: warn_point}],
            //     showInLegend: false,
            //     marker: {
            //         symbol: 'circle',
            //         radius:5
            //     }
            // },
            ],
            legend: {
                // layout: 'horizontal',
                // align: 'center',
                // verticalAlign: 'bottom'
                layout: 'vertical',
                align: 'left',
                x: 85,
                verticalAlign: 'top',
                y: 55,
                floating: true,
                symbolHeight:8,
                symbolWidth: 16,
                symbolRadius: 0,
            },
            responsive: {
                rules: [{
                    condition: {
                        maxWidth: 500
                    },
                    chartOptions: {

                    }
                }]
            },
            //预警标注
            // annotations: [{
            //         labels: [{
            //         point: 'warn',
            //         text: '技术突袭预警\n预警等级：' + data.warning_level
            //     }],
            // }],
        });
    }

    //趋势预测
    function printPredictLabel2(data) {

        var serialChart2 = Highcharts.chart('predict_div2', {
            title: {
                text: select_area + '领域发展趋势预测图'
            },
            colors: [ '#c70831', 'rgba(0,201,66,0.97)','rgba(0,171,201,0.97)',
                'rgba(214,229,6,0.97)','rgba(118,57,220,0.97)','rgba(198,105,35,0.97)'],
            subtitle: {
                text: ''
            },
            yAxis: {
                title: {
                    text: '科技研发实力'
                }
            },
            legend: {
                enabled: true,
                layout: 'vertical',
                align: 'right',
                verticalAlign: 'middle'
            },
            plotOptions: {
                series: {
                    label: false,
                    pointStart: 2000
                }
            },
            series:[],
            responsive: {
                rules: [{
                    condition: {
                        maxWidth: 500
                    },
                    chartOptions: {
                        legend: {
                            layout: 'horizontal',
                            align: 'center',
                            verticalAlign: 'bottom'
                        }
                    }
                }]
            }
        });

        var result= [];
        var red1 = {};
        red1["name"] = "历史统计值";
        red1["data"] = data.red1;
        red1["color"] = "#FF0000";
        red1["marker"] = {radius: 2}
        //red1["symbol"] = "circle";
        serialChart2.addSeries(red1)
        for(var i=1;i<6;i++) {
            var blue = {};
            blue["name"] = "未来预测值";
            var num = eval('data.blue'+i);
            console.log(num);
            blue["data"] = num;
            blue["color"] = "#005eff";
            var type = {radius: 2};
            type["symbol"] = "circle";
            blue["marker"] = type;
            var zone = [];
            var tmp = {};
            tmp["value"] = 2024;
            tmp["dashStyle"] = 'ShortDot';
            zone.push(tmp);
            blue["zones"] = zone;
            if(i != 1){
                blue["showInLegend"] = false;
            }
            result.push(blue);
            serialChart2.addSeries(blue);
        }

        for(var i=1;i<9;i++) {
            var green = {};
            green["name"] = "历史预测值";
            var num = eval('data.green'+i);
            console.log(num);
            green["data"] = num;
            green["color"] = "#00ff22";
            //green["symbol"] = "circle";
            var zone = [];
            var tmp = {};
            tmp["value"] = 2024;
            tmp["dashStyle"] = 'ShortDot';
            var type = {radius: 2};
            type["symbol"] = "diamond";
            green["marker"] = type;
            zone.push(tmp);
            green["zones"] = zone;
            result.push(green);
            if(i != 1){
                green["showInLegend"] = false;
            }
            serialChart2.addSeries(green);
        }

        result.push(red1);
        console.log("resultData=" + result);
    }

</script>
<script type="text/javascript">




    /* function showRela(data) {
         var myChart = echarts.init(document.getElementById('predict_div'));
         //echarts表格
         myChart.setOption({
             title: {
                 text: '趋势预测',
             },
             subtitle: {
                 text: 'ADE出品，必属精品'
             },
             yAxis: {
                 title: {
                     text: '论文数量'
                 }
             },
             legend: {
                 layout: 'vertical',
                 align: 'right',
                 verticalAlign: 'middle'
             },
             plotOptions: {
                 series: {
                     label: {
                         connectorAllowed: false
                     },
                     pointStart: 2010
                 }
             },
             xAxis: {
                 type: 'category',
                 data: [2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024],
             },
             series: [{
                 name: '论文数量',
                 type: 'line',
                 data: data.values,
             }]
         });

     }*/

    $(document).ready(function () {


    });

</script>
</body>
</html>


<!--
<script>
    function duibi() {
        var start = localStorage.getItem("start");
        var end = localStorage.getItem("end");
        var firstScope = localStorage.getItem("firstScope");
        var country = localStorage.getItem("country");

        var report = {
            "start": start,
            "end": end,
            "firstScope": firstScope,
            "country":country,
        }

        $.ajax({
            url: "http://127.0.0.1:7450/detail",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback",//回调方法
            contentType: 'application/json',
            data: {
                'field_name': "AI",
                'country_list': JSON.stringify(['中国', '美国', '俄罗斯', '法国', '英国']),
                'start_year': 2016,
                'end_year': 2019
            },
            success: function (data) {
                alert(data);
                $("#detail").html(data);
            },
            error: function () {
                alert("请求失败");
            },
        });
    }

    function xuri() {
        var start = localStorage.getItem("start");
        var end = localStorage.getItem("end");
        var firstScope = localStorage.getItem("firstScope");
        var country = localStorage.getItem("country");

        var report = {
            "start": start,
            "end": end,
            "firstScope": firstScope,
            "country":country,
        }

        $.ajax({
            url: "http://127.0.0.1:7450/sunburst",
            method: 'POST',
            dataType: 'jsonp',
            jsonp: "callback",
            jsonpCallback: "successCallback",//回调方法
            contentType: 'application/json',
            data: {
                'field_name': "AI",
                'country_list': JSON.stringify(['中国', '美国', '俄罗斯', '法国', '英国']),
                'start_year': 2010,
                'end_year': 2019
            },
            success: function (data) {
                var datas =JSON.parse(data);
                var arr = [];
                for(var i=0;i<datas.length;i++){
                    console.log(datas[i]);
                    var jsonStr = JSON.stringify(datas[i]);       //转为JSON字符串
                    console.log(jsonStr);
                    var jsObject = JSON.parse(jsonStr);    //转换为json对象
                    console.log(jsObject);
                    arr.push(jsObject);
                }
                printSunShine(arr);
                console.log(arr);
            }
        });
    }

    function printSunShine(data) {
        Highcharts.setOptions({
            lang: {
                thousandsSep: ',',
                turboThreshold: 2000
            }
        });
        Highcharts.getOptions().colors.splice(0, 0, 'transparent');
        Highcharts.chart('sunshine', {
                chart: {
                    height: '100%'
                },

                title: {
                    text: '军事实力对比体系'
                },
                subtitle: {
                    text: '指标一'
                },
                series: [{
                    type: "sunburst",
                    data: data,
                    allowDrillToNode: true,
                    cursor: 'pointer',
                    dataLabels: {
                        /**
                         * A custom formatter that returns the name only if the inner arc
                         * is longer than a certain pixel size, so the shape has place for
                         * the label.
                         */
                        formatter: function () {
                            var shape = this.point.node.shapeArgs;

                            var innerArcFraction = (shape.end - shape.start) / (2 * Math.PI);
                            var perimeter = 2 * Math.PI * shape.innerR;

                            var innerArcPixels = innerArcFraction * perimeter;

                            if (innerArcPixels > 16) {
                                return this.point.name;
                            }
                        }
                    },
                    levels: [{
                        level: 2,
                        colorByPoint: true,
                        dataLabels: {
                            rotationMode: 'parallel'
                        }
                    },
                        {
                            level: 3,
                            colorVariation: {
                                key: 'brightness',
                                to: -0.5
                            }
                        }, {
                            level: 4,
                            colorVariation: {
                                key: 'brightness',
                                to: 0.5
                            }
                        }]

                }],
                tooltip: {
                    headerFormat: "",
                    pointFormat: '<b>{point.name}</b>的得分为：<b>{point.value}</b>'
                }
            }
        )
    }

    function showBarChart() {
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('barChart'));

        // 指定图表的配置项和数据
        var option = {
            title: {
                text: '中东地区网络攻防资金投入'
            },
            tooltip: {},
            legend: {
                data:['销量']
            },
            xAxis: {
                data: ["衬衫","羊毛衫","雪纺衫","裤子","高跟鞋","袜子"]
            },
            yAxis: {},
            series: [{
                name: '销量',
                type: 'bar',
                data: [5, 20, 36, 10, 10, 20]
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }

    function showLineChart(){
        // 基于准备好的dom，初始化echarts实例
        var myChart = echarts.init(document.getElementById('lineChart'));
        // 指定图表的配置项和数据
        option = {
            title:{
                text: '中东地区网络攻防投入资金变化'
            },
            xAxis: {
                type: 'category',
                data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
            },
            yAxis: {
                type: 'value'
            },
            series: [{
                data: [820, 932, 901, 934, 1290, 1330, 1320],
                type: 'line',
                smooth: true
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }

    $(function () {
        showBarChart();
        showLineChart();
        xuri();
        duibi();
    })
</script>
</body>
</html>-->
